---
title: "Untitled"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
# suppress the warnings by setting warn=-1 
options(warn=-1) 
# Install if not already installed
if (!requireNamespace("ggplot2", quietly = TRUE)) install.packages("ggplot2")
if (!requireNamespace("gamlss", quietly = TRUE)) install.packages("gamlss")
if (!requireNamespace("gamlss.data", quietly = TRUE)) install.packages("gamlss.data")

# Load the packages
library(doParallel)
library(ggplot2)
library(corrplot)
library(gamlss)
library(gamlss.ggplots)
library(gamlss.add)
library(gamlss.data)
library(gamlss.foreach)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
########################################################################
########################################################################
cc <- read.csv("../data/UCI_Credit_Card.csv")

# Just drop the ID column
cc <- cc[, -c(1)]

########################################################################
# Schema of UCI_Credit_Card.csv
# https://archive.ics.uci.edu/dataset/350/default+of+credit+card+clients
# "ID","LIMIT_BAL","SEX","EDUCATION","MARRIAGE","AGE","PAY_0","PAY_2","PAY_3","PAY_4","PAY_5","PAY_6","BILL_AMT1","BILL_AMT2","BILL_AMT3","BILL_AMT4","BILL_AMT5","BILL_AMT6","PAY_AMT1","PAY_AMT2","PAY_AMT3","PAY_AMT4","PAY_AMT5","PAY_AMT6","default.payment.next.month"
# Variable Name Role	Type	  Demographic	      Description	Units	Missing Values
# ID            ID	  Integer				                              no
# X1	      Feature	  Integer		                LIMIT_BAL		      no
# X2	      Feature	  Integer	  Sex	            SEX		            no
# X3	      Feature	  Integer	  Education Level	EDUCATION		      no
# X4	      Feature	  Integer	  Marital Status	MARRIAGE		      no
# X5	      Feature	  Integer	  Age	            AGE		            no
# X6	      Feature	  Integer		                PAY_0		          no
# X7	      Feature	  Integer		                PAY_2		          no
# X8	      Feature	  Integer		                PAY_3		          no
# X9	      Feature	  Integer		                PAY_4		          no
# X10	      Feature	  Integer		                PAY_5		          no
# X11	      Feature	  Integer		                PAY_6		          no
# X12	      Feature	  Integer		                BILL_AMT1		      no
# X13	      Feature	  Integer		                BILL_AMT2		      no
# X14	      Feature	  Integer		                BILL_AMT3		      no
# X15	      Feature	  Integer		                BILL_AMT4		      no
# X16	      Feature	  Integer		                BILL_AMT5		      no
# X17	      Feature	  Integer		                BILL_AMT6		      no
# X18	      Feature	  Integer		                PAY_AMT1		      no
# X19	      Feature	  Integer		                PAY_AMT2		      no
# X20	      Feature	  Integer		                PAY_AMT3		      no
# X21	      Feature	  Integer		                PAY_AMT4		      no
# X22	      Feature	  Integer		                PAY_AMT5		      no
# X23	      Feature	  Integer		                PAY_AMT6		      no
# Y	        Target	  Binary		                default.payment.next.month		no
names(cc)
dim(cc)
```

```{r}
# may be too many for demonstration 
########################################################################
########################################################################
# Drop older bill_amts
cc1 <- cc[, -c(13, 14, 15, 16, 17)]
dim(cc1)
names(cc1)
head(cc1)

```

```{r}
cc2  <- cc1[, -c(14, 15, 16, 17, 18)]
head(cc2)
names(cc2)
dim(cc2)

```

```{r}
cc3 <- cc[, -c(10, 11, 15, 16,17, 21, 22,23)]
head(cc3)
names(cc3)
dim(cc3)
```

```{r}
########################################################################
########################################################################
# exploring you data 
plot(cc3)
# default.payment.next.month line is of interest 
```

```{r}
# also look for high correlation in the x's
which.Data.Corr(cc3, r=0.3)
cc_cor3 <- cor(cc3)
corrplot(cc_cor3)
```

```{r}
# also look for high correlation in the x's
which.Data.Corr(cc, r=0.3)
cc_cor <- cor(cc)
corrplot(cc_cor)
```

```{r}
######################################################################## 
# is any missing
dim(cc3)
#dim(is.na(cc3)) 
dim(na.omit(cc3))
# no missing 
```

```{r}
####################################################################### 
# look of outliers
plot(default.payment.next.month~LIMIT_BAL, data=cc3)

plot(default.payment.next.month~BILL_AMT1, data=cc3)
#possible transforming?
plot(default.payment.next.month~sqrt(BILL_AMT1), data=cc3)
plot(default.payment.next.month~log(BILL_AMT1), data=cc3)
# I am not sure
plot(default.payment.next.month~PAY_0, data=cc3)
plot(default.payment.next.month~log(PAY_0), data=cc3)

```

```{r}
# a possible transformation 
#cc$SEX <- factor(cc$SEX)
plot(default.payment.next.month~factor(SEX), data=cc2)

# if it is not make it a factor
#cc$EDUCATION <- factor(cc$EDUCATION)
plot(default.payment.next.month~factor(EDUCATION), data=cc2)

#cc$MARRIAGE <- factor(cc$MARRIAGE)
plot(default.payment.next.month~factor(MARRIAGE), data=cc2)
```

```{r}
plot(default.payment.next.month~PAY_AMT1, data=cc2)

plot(default.payment.next.month~AGE, data=cc)
##################################################################
#plot(default.payment.next.month~TPopulation, data=cc)
#plot(default.payment.next.month~log(TPopulation), data=cc)
# think a possible transformation 

#plot(default.payment.next.month~AreaKm2, data=cc)
#plot(default.payment.next.month~log(AreaKm2), data=cc)
# think a possible transformation 
#plot(default.payment.next.month~PeoplePerkm2, data=cc)
#plot(default.payment.next.month~Av.GCSE.2013, data=cc)
#plot(default.payment.next.month~GrnSpacem2T, data=cc)
#plot(default.payment.next.month~log(GrnSpacem2T), data=cc)
# think a possible transformation 
# plot(default.payment.next.month~Cemissions, data=cc)
# plot(default.payment.next.month~TTprimaryS, data=cc)
```

```{r}
####################################################################### 
# check for funny values
# check why the discrete values 
# X7	      Feature	  Integer		                PAY_2		          no
# X8	      Feature	  Integer		                PAY_3		          no
# X9	      Feature	  Integer		                PAY_4		          no
# X10	      Feature	  Integer		                PAY_5		          no
# X11	      Feature	  Integer		                PAY_6		          no
# X13	      Feature	  Integer		                BILL_AMT2		      no
# X14	      Feature	  Integer		                BILL_AMT3		      no
# X15	      Feature	  Integer		                BILL_AMT4		      no
# X16	      Feature	  Integer		                BILL_AMT5		      no
# X17	      Feature	  Integer		                BILL_AMT6		      no
# X19	      Feature	  Integer		                PAY_AMT2		      no
# X20	      Feature	  Integer		                PAY_AMT3		      no
# X21	      Feature	  Integer		                PAY_AMT4		      no
# X22	      Feature	  Integer		                PAY_AMT5		      no
# X23	      Feature	  Integer		                PAY_AMT6		      no
# 
plot(default.payment.next.month~PAY_2, data=cc)
plot(default.payment.next.month~PAY_3, data=cc)
plot(default.payment.next.month~PAY_4, data=cc)
plot(default.payment.next.month~PAY_5, data=cc)
plot(default.payment.next.month~PAY_6, data=cc)

plot(default.payment.next.month~BILL_AMT2, data=cc)
plot(default.payment.next.month~log(BILL_AMT2), data=cc)
plot(default.payment.next.month~sqrt(BILL_AMT2), data=cc)
plot(default.payment.next.month~BILL_AMT3, data=cc)
plot(default.payment.next.month~BILL_AMT4, data=cc)
plot(default.payment.next.month~BILL_AMT5, data=cc)
plot(default.payment.next.month~BILL_AMT6, data=cc)

plot(default.payment.next.month~PAY_AMT2, data=cc)
plot(default.payment.next.month~log(PAY_AMT2), data=cc)
plot(default.payment.next.month~sqrt(PAY_AMT2), data=cc)
plot(default.payment.next.month~PAY_AMT3, data=cc)
plot(default.payment.next.month~PAY_AMT4, data=cc)
plot(default.payment.next.month~PAY_AMT5, data=cc)
plot(default.payment.next.month~PAY_AMT6, data=cc)

######################################################################
```

```{r}
######################################################################
# checking simple regression with normal errors 
names(cc2)

mbi_1 <- gamlss(default.payment.next.month ~ LIMIT_BAL, 
              family = BI, # BI is for Binomial distribution
              data = cc)
wp(mbi_1)

mbi_2 <- gamlss(default.payment.next.month~LIMIT_BAL+
                  AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                  BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2, 
              family=BI, # BI is for Binomial distribution
              data=cc)
wp(mbi_3)

mbi_3 <- gamlss(default.payment.next.month~LIMIT_BAL+
                  PAY_0+PAY_2, 
              family=BI, # BI is for Binomial distribution
              data=cc)
wp(mbi_3)

mbi_4 <- gamlss(default.payment.next.month~LIMIT_BAL+
                  PAY_0+PAY_2+
                  AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE), 
              family=BI, # BI is for Binomial distribution
              data=cc)
wp(mbi_4)

mbi_5 <- gamlss(default.payment.next.month~LIMIT_BAL+
                  PAY_0+PAY_2+PAY_3+
                  BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3, 
              family=BI, # BI is for Binomial distribution
              data=cc)
wp(mbi_5)

mbi_6 <- gamlss(default.payment.next.month~LIMIT_BAL+
                  PAY_0+PAY_2+
                  AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                  BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2, 
              family=BI, # BI is for Binomial distribution
              data=cc)
wp(mbi_6)

mbi_7 <- gamlss(default.payment.next.month~LIMIT_BAL+
                  PAY_0+PAY_2+PAY_3+
                  AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                  BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3, 
              family=BI, # BI is for Binomial distribution
              data=cc)
wp(mbi_7)

mbi <- gamlss(default.payment.next.month~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+AGE+
                factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+
                BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6, 
              family=BI, # BI is for Binomial distribution
              data=cc)
resid_plots(mbi)

plot(mbi)
wp(mbi)

GAIC(mbi, mbi_1, mbi_2, mbi_3, mbi_4, mbi_5, mbi_6, mbi_7)
```

```{r}
# too many observations in the top 
# we may need a positive real line distribution
# The gamma distribution

mbb <- gamlss(default.payment.next.month~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+AGE+
                factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+
                BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6, 
              family=BB, data=cc)
GAIC(mbi, mbb)
resid_plots(mbb)
wp(mbb)
```

```{r}
mdbi <- gamlss(default.payment.next.month~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+AGE+
                factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+
                BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6, 
              family=DBI, 
              data=cc)
GAIC(mbi, mdbi)
resid_plots(mdbi)
wp(mdbi)
```

```{r}
mzibb <- gamlss(default.payment.next.month~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+AGE+
                factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+
                BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6, 
                family=ZIBB, 
                data=cc)
GAIC(mbi, mzibb)
resid_plots(mzibb)
wp(mzibb)
```

```{r}
# still too many extreme values use chooseDist

T1 <- chooseDist(mbi, type="binom", parallel="snow", ncpuss=8)
T1
```

```{r}
# 6 default.payment.next.month~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6,
# 4 default.payment.next.month~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4,
# 3 default.payment.next.month~LIMIT_BAL+PAY_0+AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4,
# 2 default.payment.next.month~LIMIT_BAL+PAY_0+PAY_2+PAY_3+AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4,
mzibb6 <- gamlss(default.payment.next.month~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6,
                 family=ZIBB, 
                 data=cc)
GAIC(mbi, mzibb, mzibb1, mzibb6, mzibb5, mzibb4, mzibb3, mzibb2)
resid_plots(mzibb3)
wp(mzibb3)
#resid_qqplot(mzibb1)
#resid_wp(mzibb1)
model_wp(mbi, mzibb3)

```

```{r}
#######################################################################
#######################################################################
# first parametric model 
mbi0 <- gamlss(default.payment.next.month~1,family=BI, data=cc)
mbi2 <- stepGAICAll.B(mbi0, 
                      scope=list(lower=~1, 
                                 upper=~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+
                                        AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                                        BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6),
                      parallel="snow", ncpuss=12)
```

```{r}
# checking the model
mbi2
resid_plots(mbi2)
resid_plots(mbi2)
resid_wp(mbi2)
```

```{r}
# interpretation of the model 
fitted_terms(mbi2) # mu
# fitted_terms(mbi2,"sigma") # sigma
# fitted_terms(mbi2,"nu")# nu
# fitted_terms(mbi2,"tau")
summary(mbi2)

```

```{r}
fitted_pdf(mbi2, obs=c(1000,2000,3000, 4000), from=0, to=1000000 )
#######################################################################
```

```{r}
#######################################################################
mbi3 <- stepGAICAll.A(mbi0, 
                      scope=list(lower=~1, 
                                 upper=~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+
                                        AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                                        BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6),
                      parallel="snow", ncpuss=12)
mbi3
summary(mbi3)

GAIC(mbi, mbi2, mbi3)
```

```{r}
# checking the model
#resid_plot(mbi3)
resid_plots(mbi3)
resid_wp(mbi3)
```

```{r}
# interpretation of the model 
fitted_terms(mbi3)
#fitted_terms(mbi3,"sigma")
# fitted_terms(mbi3,"nu")
#fitted_terms(mbi3,"tau")

fitted_terms(mbi3, partial=T)
# fitted_terms(mbi3,"sigma",  partial=T) # The model for sigma has only the constant fitted
# fitted_terms(mbi3,"nu", partial=T)
# fitted_terms(mbi3,"tau", partial=T)
```

```{r}
mbi3
summary(mbi3)
fitted_pdf(mbi3, obs=c(1000,2000,3000, 4000), from=0, to=1000000 )
fitted_pdf(mbi3, obs=1:100, from=0, to=1000000 )

GAIC(mbi, mbi2, mbi3)

#######################################################################
```

```{r}
#######################################################################
# smoothing terms
mbi4 <- stepGAICAll.A(mbi0, scope=list(lower=~1, 
                                         upper=~pb(LIMIT_BAL)+pb(PAY_0)+pb(PAY_2)+pb(PAY_3)+pb(PAY_4)+pb(PAY_5)+pb(PAY_6)+
                                           pb(AGE)+pb(factor(EDUCATION))+pb(factor(SEX))+pb(factor(MARRIAGE))+
                                           pb(BILL_AMT1)+pb(PAY_AMT1)+pb(BILL_AMT2)+pb(PAY_AMT2)+pb(BILL_AMT3)+pb(PAY_AMT3)+
                                           pb(BILL_AMT4)+pb(PAY_AMT4)+pb(BILL_AMT5)+pb(PAY_AMT5)+pb(BILL_AMT6)+pb(PAY_AMT6)),
                       parallel="snow", ncpuss=12, k=log(nrows(cc)))
mbi4
```

```{r}
fitted_terms(mbi3, partial=T)
fitted_terms(mbi4, partial=T)
# fitted_terms(mbi4,"sigma",  partial=T)
# fitted_terms(mbi4,"nu", partial=T)
#fitted_terms(mbi4,"tau", partial=T)

resid_plot(mbi3)
resid_plots(mbi3)
resid_wp(mbi3)

GAIC(mbi, mbi2, mbi3, mbi4)

```

```{r}
#save(mbi2, mbi3, mbi4, mbinn, mbitr, file="/Users/...")
#load("/Users/...")
#######################################################################
# neural network 
mbinn <- gamlss(default.payment.next.month~nn(~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+
                                              AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                                              BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6,  
                                              size=10, decay=0.01),
                 # sigma.fo=~nn(~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+
                 #              AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                 #              BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6,  size=5, decay=0.1),
                 #  nu.fo=~nn(~LIMIT_BAL+sqrt(BILL_AMT1)+log(EDUCATION)+MARRIAGE+
                 #                PAY_0+PAY_AMT1+AGE),
                 #  tau.fo=~nn(~LIMIT_BAL+sqrt(BILL_AMT1)+log(EDUCATION)+MARRIAGE+
                 #              PAY_0+PAY_AMT1+AGE),
                 family=BI, data=cc,  c.crit=0.01)

plot(getSmo(mbinn))  
plot(getSmo(mbinn, parameter="sigma"))       
resid_plots(mbinn )
resid_wp(mbinn )

GAIC(mbi, mbi2, mbi3, mbi4, mbinn)
GAIC(mbi, mbi2, mbi3, mbi4, mbinn, k=log(nrows(cc)))
#######################################################################
#######################################################################                
# regression trees

mbitr <- gamlss(default.payment.next.month~tr(~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+
                                        AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                                        BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6),
                  # sigma.fo=~tr(~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+
                  #                      AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                  #                      BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6),
                  # nu.fo=~tr(~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+
                  #                      AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                  #                      BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6),
                  # tau.fo=~tr(~LIMIT_BAL+PAY_0+PAY_2+PAY_3+PAY_4+PAY_5+PAY_6+
                  #                     AGE+factor(EDUCATION)+factor(SEX)+factor(MARRIAGE)+
                  #                      BILL_AMT1+PAY_AMT1+BILL_AMT2+PAY_AMT2+BILL_AMT3+PAY_AMT3+BILL_AMT4+PAY_AMT4+BILL_AMT5+PAY_AMT5+BILL_AMT6+PAY_AMT6),
                  family=BI, data=cc, c.crit=0.01,  bf.cyc=1)
plot(getSmo(mbitr))
text(getSmo(mbitr))

plot(getSmo(mbitr, parameter="sigma"))
text(getSmo(mbitr, parameter="sigma"))

#plot(getSmo(mbitr, parameter="nu"))
#text(getSmo(mbitr, parameter="nu"))
getSmo(mbitr, parameter="nu")
resid_plots(mbitr)

GAIC(mbi, mbi2, mbi3, mbi4, mbinn, mbitr) 
GAIC(mbi1, mbi2, mbi3, mbi4, mbinn, mbitr,  k=log(nrows(cc)))
#####################################################################
```

```{r}
#####################################################################
str(cc3)
dim(cc3)
l1 <- lm(default.payment.next.month~., data=cc3)
summary(l1)
m1 <- gamlss(default.payment.next.month~., data=cc3)

resid_plots(m1)
wp(m1)

m2 <- gamlss(default.payment.next.month~., data=cc3, family=DBI)
resid_plots(m2)
resid_wp(m2)
summary(m2)
######################################################################
```

```{r}
######################################################################
X <- as.matrix(cc3[,2:19])
class(X)
dim(X)
mod1 <- gamlss(default.payment.next.month~pc(x=X), data=cc3, family=MN3)

resid_wp(mod1)

mod2 <- gamlss(default.payment.next.month~pc(x=X), sigma.fo=~pc(x=X), data=cc3, family=ZABB)             
resid_wp(mod2)

mod3 <- gamlss(default.payment.next.month~pc(x=X), sigma.fo=~pc(x=X), nu.fo=~pc(x=X), data=cc3, family=ZIBB)             

GAIC(m2, mod1, mod2,mod3)

GAIC(m2, mod1, mod2,mod3,k=log(4884))

resid_wp(mod2)

model_wp(m2, mod1, mod2)

```

```{r}
#--------------------------------------------------------
#interaction formula
#
form2 <- as.formula(paste("default.payment.next.month ~ ",paste0(paste0("(",paste(colnames(X), collapse='+')), ")^2"))) 
form2

m22 <- gamlss(form2, data=cc3)

m22
#summary(m22)

resid_plots(m22)
wp(m22)


m33 <- gamlss(form2, data=cc3, family=BB)
resid_plots(m33)
resid_wp(m33)

GAIC(m2, mod1, mod2,mod3, m33, k=log(rows(cc)-1)
#########################################################
```
