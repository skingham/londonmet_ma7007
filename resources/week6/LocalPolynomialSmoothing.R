########################################################
########################################################
# script to demonstrate local polynomial fitting
########################################################
########################################################
rm(list=ls())
# ------------------------------------------------
# get the functions
# DOWNLOAD "LocalRegressionDemo.R" AND PUT IT IN A DIRECTORY
# SAY mydirectory
# YOU CAN READ IT AS FOLLOWS BY CHANGING THE PATH
source('~/Dropbox/library/gamlss.demo/R/LocalRegressionDemo.R')
########################################################
########################################################
# generating the data
########################################################
########################################################
n <- 100
x <- seq(0, 1, length = n)*1.4
set.seed(123)
y <- 1.2 + .3*sin(5  * x) + rnorm(n) * 0.2
plot(y~x)
########################################################
########################################################
# Local neighbourhood smoothers
########################################################
########################################################
# degree 0 constant
########################################################
########################################################
# MEAN FITTING
########################################################
########################################################
#op <- par(ask=TRUE)
# span = 0.5 
fv <- rep(0,100)
for (i in 1:100)
{
  fv[i]<- LPOL(y,x, deg=0, position=i)
  Sys.sleep(0.08)
}

plot(y~x, pch=20)
lines(fv~x, col="red", lwd=2)
points(fv~x, col="red",pch=20)
########################################################
########################################################
# span=0.2
for (i in 1:100)
{
  fv[i]<- LPOL(y,x, deg=0, span=.2, position=i)
  Sys.sleep(0.1)
}
plot(y~x, pch=20)
lines(fv~x, col="red", lwd=2)
points(fv~x, col="red",pch=20)
########################################################
########################################################
########################################################
########################################################
# span=2
# fit a constant
for (i in 1:100)
{
  fv[i]<- LPOL(y,x, deg=0, span=2, position=i)
  Sys.sleep(0.05)
}
plot(y~x, pch=20)
lines(fv~x, col="red", lwd=2)
points(fv~x, col="red",pch=20)
########################################################
########################################################
# span=0.01
# interpolates the data
for (i in 1:100)
{
  fv[i]<- LPOL(y,x, deg=0, span=0.01, position=i)
  Sys.sleep(0.05)
}
plot(y~x, pch=20)
lines(fv~x, col="red", lwd=2)
points(fv~x, col="red",pch=20)
#
########################################################
########################################################
# LINEAR FITTING
########################################################
########################################################
#op <- par(ask=TRUE)
# span = 0.5 
fv <- rep(0,100)
for (i in 1:100)
{
  fv[i]<- LPOL(y,x, deg=1, position=i)
  Sys.sleep(0.1)
}

plot(y~x, pch=20)
lines(fv~x, col="red", lwd=2)
points(fv~x, col="red",pch=20)
#par(op)
########################################################
########################################################
# QUADRATIC FITTING
########################################################
########################################################
# span=0.2
for (i in 1:100)
{
  fv[i]<- LPOL(y,x, deg=2, span=.2, position=i)
  Sys.sleep(0.1)
}
plot(y~x, pch=20)
lines(fv~x, col="red", lwd=2)
points(fv~x, col="red",pch=20)
#par(op)
########################################################
########################################################
########################################################


########################################################
########################################################
# kernel smoothers 
########################################################
########################################################
fv <- rep(0,100)
for (i in 1:100)
{
  fv[i]<- WLPOL(y,x, deg=0, sd=0.2, position=i)
  Sys.sleep(0.08)
}

plot(y~x, pch=20)
lines(fv~x, col="red", lwd=2)
points(fv~x, col="red",pch=20)

######################################################
######################################################
for (i in 1:100)
{
  fv[i]<- WLPOL(y,x, deg=0, sd=0.1, scale=.5, position=i)
  Sys.sleep(0.08)
}

plot(y~x, pch=20)
lines(fv~x, col="red", lwd=2)
points(fv~x, col="red",pch=20)

######################################################
######################################################
for (i in 1:100)
{
  fv[i]<- WLPOL(y,x, deg=2, sd=0.1, scale=.5, position=i)
  Sys.sleep(0.08)
}

plot(y~x, pch=20)
lines(fv~x, col="red", lwd=2)
points(fv~x, col="red",pch=20)
#####################################################
#####################################################



##################################################################
##################################################################
# Using the animation package
##################################################################
##################################################################
library(animation)
ani.record(reset = TRUE) 
for (i in 1:100) {
  LPOL(y,x, deg=1, position=i)
  ani.record()  # record the current frame
}
ani.replay()
##################################################################
##################################################################
# Using the animation package END
##################################################################
##################################################################
# loess smoothing 
##################################################################
##################################################################
m1 <- loess(y~x)
plot(y~x, pch=20)
lines(fitted(m1)~x, col="red", lwd=2)

m1 <- loess(y~x, span=.1)
plot(y~x, pch=20)
lines(fitted(m1)~x, col="red", lwd=2)

m1 <- loess(y~x, span=2)
plot(y~x, pch=20)
lines(fitted(m1)~x, col="red", lwd=2)
##################################################################
##################################################################
# 2 dimensinal smoothing in loess()
##################################################################
##################################################################
library(gamlss)
r1 <- gamlss(R~lo(~Fl*A), data=rent, gamily=GA, bf.cyc=1)
term.plot(r1)
vis.lo(getSmo(r1))
vis.lo(getSmo(r1), se=1.76)
vis.lo(getSmo(r1), se=1.76, partial.resid = T)
##################################################################
##################################################################
r2 <- gamlss(R~lo(~Fl*A), sigma.fo=~lo(~Fl*A), data=rent, gamily=GA, bf.cyc=1)
term.plot(r2)
vis.lo(getSmo(r2))
vis.lo(getSmo(r2), se=1.76)
vis.lo(getSmo(r1), se=1.76, partial.resid = T)

vis.lo(getSmo(r2,"sigma") )
vis.lo(getSmo(r2, "sigma"), se=1.76)
vis.lo(getSmo(r2, "sigma"), se=1.76, partial.resid = T)
#################################################################
#################################################################
